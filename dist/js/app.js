"use strict";function initMap(){map=new google.maps.Map($("#map").get(0),{center:start_point,styles:mapstyles,zoom:9,mapTypeControl:!1}),ko.applyBindings(new ViewModel)}var start_point={lat:37.387474,lng:-122.057543},default_search_key="food",third_api_url="https://free-api.heweather.com/s6/weather/forecast?location=%E5%9C%A3%E4%BD%95%E5%A1%9E&key=7959b2d195af4b38a2afe26eccd7493f&lang=cn&unit=m",map=void 0,mapErrorHandler=function(){},ViewModel=function(){var e=this,t=this;this.current=ko.observable(""),this.currentFilter=ko.observable(""),this.markers=ko.observableArray([]),this.infoWindow=new google.maps.InfoWindow,function(){var e=!0;map.addListener("bounds_changed",function(){var r=map.getBounds(),a=new google.maps.places.Autocomplete($("#search-place").get(0),{bounds:r});a.addListener("place_changed",function(){var e=a.getPlace();t.searchPlaces(e.formatted_address)}),e&&(t.searchPlaces(default_search_key),e=!1)})}(),this.filter=function(){var e=t.currentFilter().trim().toLowerCase(),r=!0,a=!1,n=void 0;try{for(var o,i=t.markers()[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var s=o.value;-1!==s.title.toLowerCase().indexOf(e)?s.setVisible(!0):s.setVisible(!1)}}catch(e){a=!0,n=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw n}}},this.markersFilter=ko.pureComputed(function(){return e.markers().filter(function(e){var r=t.currentFilter().trim().toLowerCase();return-1!==e.title.toLowerCase().indexOf(r)})},this),this.search=function(){var e=this.current().trim();e&&t.searchPlaces(e)},this.searchPlaces=function(e){if(e||(e=t.current()),0!==e.length){t.clearMarkers();var r=map.getBounds();new google.maps.places.PlacesService(map).textSearch({query:e,bounds:r},function(e,r){r===google.maps.places.PlacesServiceStatus.OK&&t.createMarkersForPlaces(e)})}},this.createMarkersForPlaces=function(e){for(var r=new google.maps.LatLngBounds,a=function(a){var n=e[a],o=void 0;(o=new google.maps.Marker({map:map,title:n.name,position:n.geometry.location,id:n.place_id})).addListener("click",function(){t.populateInfoWindow(o,t.infoWindow)}),t.markers.push(o),n.geometry.viewport?r.union(n.geometry.viewport):r.extend(n.geometry.location)},n=0;n<e.length;n++)a(n);map.fitBounds(r)},this.clearMarkers=function(){t.markers().forEach(function(e){return e.setMap(null)}),t.markers.removeAll()},this.showPlaceInfo=function(e){google.maps.event.trigger(e,"click"),$("#nav").removeClass("open")}.bind(this),this.populateInfoWindow=function(e,t){if(t.marker!=e){t.marker=e;new google.maps.places.PlacesService(map).getDetails({placeId:e.id},function(r,a){if(a===google.maps.places.PlacesServiceStatus.OK){var n="<div>";r.name&&(n+="<h3>"+r.name+"</h3>"),r.formatted_address&&(n+="<br>"+r.adr_address),r.formatted_phone_number&&(n+="<br>"+r.formatted_phone_number),n+="</div><br />";var o="<div><strong>天气</strong><br><p>正在获取数据 </p></div>";t.setContent(n+o),t.open(map,e),fetch(third_api_url).then(function(e){return e.json()}).then(function(r){var a=r.HeWeather6[0].daily_forecast;o="<div><strong>天气</strong><ul>",a.forEach(function(e){o+="<li>"+e.date+": 白天"+e.cond_txt_d+"，晚上"+e.cond_txt_n+" 最低"+e.tmp_min+"摄氏度 最高"+e.tmp_max+" C</li>"}),o+="</ul></div>",t.setContent(n+o),t.open(map,e)}).catch(function(r){o="<div><strong>天气</strong><br><p>获取错误: </p><span>"+r+"</span></div>",t.setContent(n+o),t.open(map,e)})}}),t.addListener("closeclick",function(){return t.marker=null})}},this.navOpenClass=ko.observable(""),this.toggleNav=function(){var e=""===t.navOpenClass();t.navOpenClass(e?"open":""),event.stopPropagation()}};