"use strict";function initMap(){map=new google.maps.Map($("#map").get(0),{center:start_point,styles:mapstyles,zoom:9,mapTypeControl:!1}),ko.applyBindings(new ViewModel)}var start_point={lat:37.387474,lng:-122.057543},wikipedia_api_url="https://free-api.heweather.com/s6/weather/forecast?location=%E5%9C%A3%E4%BD%95%E5%A1%9E&key=7959b2d195af4b38a2afe26eccd7493f&lang=cn&unit=m",map=void 0,ViewModel=function(){var e=this;this.current=ko.observable(),this.use_poi_icon=ko.observable(),this.markers=ko.observableArray([]),this.infoWindow=new google.maps.InfoWindow,this.centerMarker=new google.maps.Marker({position:start_point,title:"硅谷",animation:google.maps.Animation.DROP,id:1}),map.addListener("bounds_changed",function(){var o=new google.maps.places.Autocomplete($("#search-place").get(0),{bounds:map.getBounds()});o.addListener("place_changed",function(){var n=o.getPlace();e.searchPlaces(n.formatted_address)})}),e.centerMarker.addListener("click",function(){e.showCenterInfoWindow(e.centerMarker,e.infoWindow)}),e.centerMarker.setMap(map),this.showCenterInfoWindow=function(e,o){if(o.marker!=e){o.marker=e;var n="<div><h1>硅谷-天气</h1><br><p>正在获取数据 </p></div>";o.setContent(n),o.open(map,e),fetch(wikipedia_api_url).then(function(e){return e.json()}).then(function(e){forecast=e.HeWeather6[0].daily_forecast,n="<div><h1>硅谷-天气</h1><ul>",forecast.forEach(function(e){n+="<li>"+e.date+": 白天"+e.cond_txt_d+"，晚上"+e.cond_txt_n+" 最低"+e.tmp_min+"摄氏度 最高"+e.tmp_max+"摄氏度 "+e.wind_dir+" "+e.wind_sc+"</li>"}),n+="</ul></div>",console.log(n),o.setContent(n)}).catch(function(e){console.error(e),n="<div><h1>硅谷-天气</h1><br><p>获取错误: </p><span>"+e+"</span></div>",o.setContent(n)}),o.addListener("closeclick",function(){o.marker=null})}},this.search=function(){var o=this.current().trim();o&&e.searchPlaces(o)},this.searchPlaces=function(o){if(null==o&&(o=$("#search-place").get(0).value),o.length=0)window.alert("You must enter an address.");else{e.clearMarkers();var n=map.getBounds();new google.maps.places.PlacesService(map).textSearch({query:o,bounds:n},function(o,n){n===google.maps.places.PlacesServiceStatus.OK&&e.createMarkersForPlaces(o)})}},this.createMarkersForPlaces=function(o){for(var n=new google.maps.LatLngBounds,a=function(a){var t=o[a],r=void 0;(r=e.use_poi_icon()?new google.maps.Marker({map:map,icon:{url:t.icon,size:new google.maps.Size(35,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,34),scaledSize:new google.maps.Size(25,25)},title:t.name,position:t.geometry.location,id:t.place_id}):new google.maps.Marker({map:map,title:t.name,position:t.geometry.location,id:t.place_id})).addListener("click",function(){e.populateInfoWindow(r,e.infoWindow)}),e.markers.push(r),t.geometry.viewport?n.union(t.geometry.viewport):n.extend(t.geometry.location)},t=0;t<o.length;t++)a(t);map.fitBounds(n)},this.clearMarkers=function(){console.log("clearMarkers"),e.markers().forEach(function(e){return e.setMap(null)}),e.markers.removeAll(),e.centerMarker.setMap(null)},this.showPlaceInfo=function(e){google.maps.event.trigger(e,"click"),$("#nav").removeClass("open")}.bind(this),this.populateInfoWindow=function(e,o){if(o.marker!=e){o.marker=e;new google.maps.places.PlacesService(map).getDetails({placeId:e.id},function(n,a){if(a===google.maps.places.PlacesServiceStatus.OK){var t="<div>";n.name&&(t+="<strong>"+n.name+"</strong>"),n.formatted_address&&(t+="<br>"+n.adr_address),n.formatted_phone_number&&(t+="<br>"+n.formatted_phone_number),n.photos&&(t+='<br><br><img src="'+n.photos[0].getUrl({maxHeight:100,maxWidth:200})+'">'),t+="</div>",o.setContent(t),o.open(map,e)}}),o.addListener("closeclick",function(){return o.marker=null})}},this.toggleNav=function(){$("#nav").toggleClass("open"),event.stopPropagation()}};